RPC

https://wiki.swoole.com/#/coroutine

进程：每个程序运行都需要操作系统创建进程
线程：由程序进程创建的“进程”，共享进程内存资源
协程：用户态“线程”。协程可以简单理解为线程，只不过这个线程是用户态的，不需要操作系统参与，创建销毁和切换的成本非常低，和线程不同的是协程没法利用多核 cpu 的，想利用多核 cpu 需要依赖 Swoole 的多进程模型。

一个更通俗的比喻，假设 Server 就是一个工厂，那 Reactor 就是销售，接受客户订单。而 Worker 就是工人，当销售接到订单后，Worker 去工作生产出客户要的东西。而 TaskWorker 可以理解为行政人员，可以帮助 Worker 干些杂事，让 Worker 专心工作。

User 进程，Swoole 中挂到 manager 进程管理的特殊 worker 进程

master 销售/老板

reactor 秘书

manager 经理
创建回收 worker/task

worker 工人
多进程，同步阻塞/异步非阻塞

    taskWorker
    	多进程，同步阻塞

https://wiki.swoole.com/#/server/methods?id=start

Master 主进程

主进程内有多个 Reactor 线程，基于 epoll/kqueue 进行网络事件轮询。收到数据后转发到 Worker 进程去处理
Manager 进程

对所有 Worker 进程进行管理，Worker 进程生命周期结束或者发生异常时自动回收，并创建新的 Worker 进程
Worker 进程

对收到的数据进行处理，包括协议解析和响应请求。未设置 worker_num，底层会启动与 CPU 数量一致的 Worker 进程。
启动失败扩展内会抛出致命错误，请检查 php error_log 的相关信息。errno={number} 是标准的 Linux Errno，可参考相关文档。
如果开启了 log_file 设置，信息会打印到指定的 Log 文件中。

### 工具

htop
time
执行 ulimit -c unlimited，打开 core dump，查看是否有段错误

### 进程/线程/协程

什么是进程？
进程是系统中正在运行的一个程序，程序一旦运行就是进程。
进程可以看成程序执行的一个实例。
Tips：一个进程无法访问另一个进程的变量和数据结构，如果想让一个进程访问另一个进程的资源，需要使用进程间通信，比如管道，文件，套接字等。

什么是线程？
线程属于进程，是程序的执行者。
一个进程至少包含一个主线程，也可以有更多的子线程，每个线程使用其所属进程的栈空间。
线程是进程的一个实体，是进程的一条执行路径。
Tips：同一进程内的多个线程会共享部分状态，多个线程可以读写同一块内存。

什么是协程？
协程比较抽象 它是程序内部的一定调度机制；
协程是轻量级线程, 协程的创建、切换、挂起、销毁全部为内存操作，消耗是非常低的。
协程是属于线程，协程是在线程里执行的。
协程的调度是用户手动切换的，所以又叫用户空间线程。
协程的调度策略是：协作式调度。

协程与线程区别：
Swoole 的协程在底层实现上是单线程的，因此同一时间只有一个协程在工作，协程的执行是串行的。这与线程不同，多个线程会被操作系统调度到多个 CPU 并行执行。

一个协程正在运行时，其他协程会停止工作。当前协程执行阻塞 IO 操作时会挂起，底层调度器会进入事件循环。当有 IO 完成事件时，底层调度器恢复事件对应的协程的执行。

对 CPU 多核的利用，仍然依赖于 Swoole 引擎的多进程机制。

协程的适用场景：
高并发服务，如秒杀系统、高性能 API 接口、RPC 服务器，使用协程模式，服务的容错率会大大增加，某些接口出现故障时，不会导致整个服务崩溃。

Swoole 协程执行体验，可参考：https://www.jianshu.com/p/745b0b3ffae7
